<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Automatische Bibelstellenerkennung (Demo)</title>
    <style>
        main { max-width: 1600px; margin: auto; }
        .half-container { display: flex; flex-wrap: wrap; }
        .half-box {
            flex: 1; display: flex; flex-direction: column;
            justify-content: top;
            margin: 20px;
            min-width: 280px; max-width: 750px;
        }
        .half-box > div { padding: 20px; }
        #user-input { border: 1px dashed green;word-wrap: break-word; }
        #results { border: 1px dashed red; }
        #results:empty:not(:focus):before{content:attr(data-defaulttext)}
        #booknames { font-size: 0.6em; overflow-wrap: break-word; }
    </style>
<body>
    <main>
        <h1>Automatische Bibelstellenerkennung (Demo)</h1>
        <div class="half-container">
            <div id="content" class="half-box">
                <p>Hier Text anpassen/eingeben, der Bibelstellen enthält:</p>
                <div contentEditable="true" id="user-input">
                Bibelstellen können einzelne Verse referenzieren, wie 1. Mo 4, 23 oder mehrere Verse umfassen Jos 4, 12-20. 
                Auch Kapitel übergreifende Angaben werden erkannt: 1. Mo 1,15 - 2,4.
                Mal steht hinter dem Buch ein Punkt Röm. 4,1 oder es fehlt das Leerzeichen und kein Vers angegeben Offb22.
                <br /><br />
                Auch Bibelverse mit Punkt getrennt werden erkannt: 1. Mo 3,4.7-9.20.
                Zeilenumbrüche Gen 2,<br />
                23 sind kein Problem.
                </div>
            </div>
            <div id="detection" class="half-box">
                <p>Erkannte Bibelstellen <small>(Lutherübersetzung, Revision von 1912, gemeinfrei)</small>:</p>
                <div id="results" data-defaulttext="Keine Bibelstellen erkannt."></div>
            </div>
        </div>
        <div>
            <h3>Funktionen</h3>
            <ul>
                <li>Erkennung und Auflösung von Bibelstellenangaben in beliebigen Texten</li>
                <li>Anzeige des referenzieren Bibeltextes (lizenzfreie Übersetzung)</li>
                <li>Verse können mit der URL vorausgewählt werden, z.B. <a href="#q=Joh3,16">#q=Joh3,16</a>, Beispiele:
                    <ul>
                        <li><a href="#q=Röm1,1-7;1Kor1,1-3;2Kor1,1-2;Gal1,1-3;Kol1,1-2;Eph1,1-2;Phil1,1-2;1Thess1,1;2Thess1,1-2;1Tim1,1;2Tim1,1-2;Tit1,1-4;Phlm1,1-3;Jak1,1;Jud1,1-2;1Petr1,1-2;2Petr1,1-2;1Joh1,1;2Joh1,1-2;3Joh1,1-2;Hebr1,1;Offb1,4">Alle Briefeinleitungen des neuen Testaments</a></li>
                    </ul>
                </li>
            </ul>
            <h3>Beschränkungen:</h3>
            <ul>
                <li>Nur deutsche Notationen und Buchnamen werden erkannt</li>
                <li>Nicht alle Varianten der Buchnamen werden erkannt (siehe unten)</li>
                <!--<li>Es erfolgt keine Prüfung ob der Vers/das Kapitel wirklich existiert (z.B. 1. Mo 4,99; Obd 2,1)</li>-->
                <li>Bei Büchern mit nur einem Kapitel muss die Kapitelnummer 1 mit angegeben werden. Obd 10 für Obd 1,10 wird nicht erkannt.</li>
                <li>Wenn man dem Link folgt: bibleserver.com erkennt beim Markieren nicht alle Varianten der Versangabe</li>
            </ul>
            <h3>Bekannte Buchnamen:</h3>
            <p id="booknames"></p>
        </div>
        <!--
        <div>
            <h3>Mögliche Weiterentwicklung:</h3>
            <ul>
                <li>Vorauswahl von Bibelstellen in URL-Hash</li>
                <li>Konkordanz-Funktion</li>
                <li>Parallelstellen</li>
                <li>Notizen teilen (erfordert serverseitige Speicherung)</li>
                <li>OCR-Erkennung (z.B. mit einer mobilen App)</li>
                <li>Statt Texteingabe Angabe einer URL (erfordert Backend oder lokale Installation)</li>
                <li>Druckfunktion</li>
                <li>Apps für Desktop und mobile Geräte</li>
                <li>Inhaltsanalyse von Bibeltexten, statistische Auswertung</li>
            </ul>
            <h3>USPs</h3>
            <ul>
                <li>Einfache Zusammenstellung von Bibelstellen für Bibelarbeiten u.ä.</li>
                <li>Benutzung ohne Installation/Anmeldung</li>
        </div>-->
    </main>
    
    <script src="bundle.js"></script>
    <script>
        const getFragmentQuery = () => {
            if (window.document.location.hash.length < 3) {
                return;
            }
            const paramStrings = window.document.location.hash.substring(1).split('&');
            return paramStrings.reduce((result, paramString) => {
                if (paramString.indexOf('=') > 0) {
                    const key = paramString.split('=')[0];
                    const value = decodeURIComponent(paramString.split('=')[1]);
                    result[key] = value;
                }
                return result;
            }, {});
        };

        const hasFragmentQuery = () => getFragmentQuery() && getFragmentQuery()['q'] && getFragmentQuery()['q'].length > 1;

        const restoreFromFragmentQuery = (inputElement) => {
            const fragmentQuery = getFragmentQuery();
            if (fragmentQuery && fragmentQuery['q'].length > 1) {
                inputElement.innerText = fragmentQuery['q'];
            }
        };
    </script>
    <script>
        const bookNamesElement = window.document.getElementById('booknames');
        const outputElement = window.document.getElementById('results');
        const userInputElement = window.document.getElementById('user-input');
        const eventWorker = window.eventWorker.EventWorker(window);
        const userNotes = window.userNotes.UserNotes(window.localStorage, userInputElement);
        if (hasFragmentQuery()) {
            restoreFromFragmentQuery(userInputElement);
        } else {
            userNotes.restore();
        }
        const processUserInput = window.app.getInputProcessor(
            userNotes.get,
            window.detect,
            window.reader.getVerse,
            window.render.BibleTextRenderer(outputElement));
        
        processUserInput();
        const scheduleProcessing = () => eventWorker.add(() => {
            userNotes.save();
            return processUserInput();
        });
        userInputElement.addEventListener("input", scheduleProcessing);
        
        window.addEventListener("hashchange", () => {
            if (hasFragmentQuery()) {
                restoreFromFragmentQuery(userInputElement);
            } else {
                userNotes.restore();
            }
            scheduleProcessing();
        }); 
        bookNamesElement.innerHTML = window.detect._booknames.join(',');
    </script>
</body>
</html>